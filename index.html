<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Seller 2025 - Refined</title>
    <style>
        :root {
            --primary: #ffe600; /* ML Yellow */
            --secondary: #2d3277; /* ML Blue */
            --bg-color: #f4f6f8;
            --card-bg: #ffffff;
            --text-color: #333;
            --success: #00a650;
            --danger: #ff3e4e;
            --info: #3483fa;
            --border: #ced4da;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container { max-width: 1100px; margin: 0 auto; }
        
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: var(--secondary); margin: 0; font-size: 1.8rem; }
        .header p { color: #666; font-size: 1rem; margin-top: 5px; }

        /* --- CARDS --- */
        .global-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-top: 5px solid var(--secondary);
        }

        .strategy-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }

        /* --- REPUTATION SELECTOR --- */
        .reputation-section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .rep-selector { display: flex; gap: 15px; margin-top: 10px; }
        .rep-btn {
            flex: 1; padding: 15px; border: 2px solid var(--border); border-radius: 8px;
            cursor: pointer; font-size: 1rem; font-weight: 600; text-align: center;
            transition: all 0.2s ease; background: white; color: #777;
        }
        .rep-btn:hover { border-color: #aaa; }
        .rep-btn.active { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .rep-btn.rep-green.active { border-color: var(--success); background-color: #f0fdf4; color: var(--success); }
        .rep-btn.rep-yellow.active { border-color: #ffc107; background-color: #fffbf0; color: #b48900; }
        .rep-btn.rep-orange.active { border-color: var(--danger); background-color: #fff5f5; color: var(--danger); }

        /* --- INPUT GRID --- */
        .grid-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
        }

        label { display: flex; align-items: center; font-weight: 600; font-size: 0.9rem; margin-bottom: 8px; color: #444; }
        
        input, select {
            width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 6px;
            font-size: 16px; transition: border-color 0.2s; box-sizing: border-box;
        }
        input:focus, select:focus { border-color: var(--info); outline: none; }

        /* --- REFINED INPUT GROUP --- */
        .input-group-refined {
            display: flex;
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
        }
        .input-group-refined:focus-within {
            border-color: var(--info);
            box-shadow: 0 0 0 1px var(--info);
        }
        .input-group-refined input {
            border: none;
            border-radius: 0;
            flex-grow: 1;
        }
        .input-group-refined input:focus { box-shadow: none; }
        
        /* The Minimalist Select */
        .input-group-refined select {
            border: none;
            border-left: 1px solid var(--border);
            border-radius: 0;
            background-color: #f8f9fa;
            width: 70px; /* Compact width */
            text-align: center;
            font-weight: bold;
            color: #555;
            cursor: pointer;
        }
        .input-group-refined select:hover { background-color: #e9ecef; }

        /* Dynamic Caption */
        .field-caption {
            display: block;
            font-size: 0.8rem;
            color: #666;
            margin-top: 6px;
            min-height: 1.2em; /* Prevent layout jump */
        }

        /* --- TOOLTIPS --- */
        .tooltip-container { position: relative; margin-left: 6px; display: inline-flex; }
        .tooltip-icon {
            width: 18px; height: 18px; background: #e9ecef; color: #666;
            border-radius: 50%; font-size: 11px; display: flex; align-items: center; justify-content: center;
            cursor: help; font-weight: bold;
        }
        .tooltip-text {
            visibility: hidden; opacity: 0; width: 240px; background-color: #2c3e50; color: #fff;
            text-align: left; border-radius: 6px; padding: 12px; position: absolute; z-index: 100;
            bottom: 140%; left: 50%; margin-left: -120px; transition: 0.2s; pointer-events: none;
            font-size: 0.8rem; font-weight: normal; line-height: 1.4; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .tooltip-text::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -6px;
            border-width: 6px; border-style: solid; border-color: #2c3e50 transparent transparent transparent;
        }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; transform: translateY(-5px); }

        /* --- LAYOUT STRATEGIES --- */
        .strategies-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        h2 { margin-top: 0; color: var(--secondary); font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }

        /* Results */
        .result-panel {
            background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px;
            padding: 20px; text-align: center; margin: 20px 0;
        }
        .big-price { font-size: 2.2rem; font-weight: 800; color: var(--secondary); display: block; margin: 5px 0; }
        
        .table-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f1f1f1; font-size: 0.9rem; }
        .table-row:last-child { border-bottom: none; }
        .val-neg { color: var(--danger); }
        .val-pos { color: var(--success); font-weight: bold; }
        
        .bar-chart { height: 8px; background: #e0e0e0; border-radius: 4px; display: flex; overflow: hidden; margin-top: 15px; }
        .bar-segment { height: 100%; transition: width 0.5s ease-out; }

        .sync-btn {
            background: var(--info); color: white; border: none; padding: 12px; border-radius: 6px;
            font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; font-size: 0.95rem;
        }
        .sync-btn:hover { background: #1870f0; }

        .alert-box {
            background: #fff3cd; color: #856404; padding: 10px; border-radius: 6px; font-size: 0.85rem;
            margin-top: 10px; display: none; border-left: 4px solid #ffc107; text-align: left;
        }

        @media (max-width: 768px) {
            .strategies-grid { grid-template-columns: 1fr; }
            .rep-selector { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Calculadora Seller 2025</h1>
        <p>Planejamento de Pre√ßo e Simula√ß√£o de Margem Real</p>
    </div>

    <div class="global-card">
        
        <div class="reputation-section">
            <label>
                Selecione sua Reputa√ß√£o Atual
                <div class="tooltip-container">
                    <span class="tooltip-icon">?</span>
                    <span class="tooltip-text">A reputa√ß√£o define seu desconto no frete. Verdes pagam ~50% menos. Laranjas pagam tabela cheia.</span>
                </div>
            </label>
            <div class="rep-selector">
                <div class="rep-btn rep-green active" onclick="setRep('green')" id="btn-green">
                    Verde / L√≠der / Oficial
                    <div style="font-size:0.75rem; margin-top:4px; font-weight:normal;">Maior desconto no frete</div>
                </div>
                <div class="rep-btn rep-yellow" onclick="setRep('yellow')" id="btn-yellow">
                    Amarela
                    <div style="font-size:0.75rem; margin-top:4px; font-weight:normal;">Desconto m√©dio</div>
                </div>
                <div class="rep-btn rep-orange" onclick="setRep('orange')" id="btn-orange">
                    Laranja / Vermelha
                    <div style="font-size:0.75rem; margin-top:4px; font-weight:normal;">Sem desconto</div>
                </div>
            </div>
        </div>

        <div class="grid-inputs">
            
            <div>
                <label>
                    Custo do Produto (R$)
                    <div class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Quanto voc√™ paga no produto (fornecedor + impostos de compra).</span>
                    </div>
                </label>
                <input type="number" id="productCost" placeholder="Ex: 25,00" step="0.01" oninput="recalcAll()">
            </div>

            <div>
                <label>
                    Despesas Operacionais
                    <div class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Custos extras como embalagem, fita, brindes ou marketing.</span>
                    </div>
                </label>
                
                <div class="input-group-refined">
                    <input type="number" id="opExpenses" placeholder="Ex: 3,00" step="0.01" oninput="recalcAll()">
                    <select id="opType" onchange="updateOpHint(); recalcAll()">
                        <option value="fixed">R$</option>
                        <option value="pct">%</option>
                    </select>
                </div>
                <small id="opHint" class="field-caption">Valor fixo somado ao custo.</small>
            </div>

            <div>
                <label>
                    Peso (Tabela ML 2025)
                    <div class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Peso considerado para o frete (Maior entre f√≠sico e volum√©trico).</span>
                    </div>
                </label>
                <select id="weight" onchange="recalcAll()">
                    <option value="0.3">At√© 300g</option>
                    <option value="0.5">300g a 500g</option>
                    <option value="1.0">500g a 1kg</option>
                    <option value="2.0">1kg a 2kg</option>
                    <option value="3.0">2kg a 3kg</option>
                    <option value="5.0">3kg a 5kg</option>
                    <option value="9.0">5kg a 9kg</option>
                    <option value="13.0">9kg a 13kg</option>
                </select>
            </div>

            <div>
                <label>
                    Imposto Nota Fiscal (%)
                    <div class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Al√≠quota do Simples Nacional sobre a venda. Se for MEI, deixe 0.</span>
                    </div>
                </label>
                <input type="number" id="taxRate" placeholder="Ex: 4.0" step="0.1" oninput="recalcAll()">
            </div>

            <div>
                <label>
                    Tipo de An√∫ncio
                    <div class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Premium cobra ~5% a mais, mas oferece parcelamento sem juros.</span>
                    </div>
                </label>
                <select id="listingType" onchange="recalcAll()">
                    <option value="classic">Cl√°ssico (11.5%)</option>
                    <option value="premium">Premium (16.5%)</option>
                </select>
            </div>
        </div>
    </div>

    <div class="strategies-grid">
        
        <div class="strategy-card">
            <h2>üéØ Definir Pre√ßo Ideal</h2>
            <div style="font-size:0.9rem; color:#666; margin-bottom:15px;">Diga quanto quer lucrar, n√≥s calculamos o pre√ßo.</div>
            
            <label>Margem L√≠quida Desejada (%)</label>
            <input type="number" id="targetMargin" placeholder="Ex: 15" step="1" oninput="calcReverse()">
            
            <div class="result-panel">
                <small>Pre√ßo de Venda Sugerido</small>
                <span class="big-price" id="rev-price">R$ 0,00</span>
                <div id="rev-alert" class="alert-box"></div>
                <button class="sync-btn" onclick="syncPrice()">‚¨áÔ∏è Simular Detalhes com este Pre√ßo</button>
            </div>

            <div class="table-row"><span>Custo Total</span><span class="val-neg" id="rev-cost">-</span></div>
            <div class="table-row"><span>Comiss√£o + Imposto</span><span class="val-neg" id="rev-fees">-</span></div>
            <div class="table-row"><span>Frete / Taxa ML</span><span class="val-neg" id="rev-ship">-</span></div>
            <div class="table-row" style="margin-top:5px; border-top:2px solid #eee; padding-top:10px;">
                <strong>Lucro L√≠quido</strong><span class="val-pos" id="rev-profit">-</span>
            </div>

            <div class="bar-chart">
                <div id="rev-bar-cost" class="bar-segment" style="background:#ccc; width:0%"></div>
                <div id="rev-bar-fee" class="bar-segment" style="background:#ffab00; width:0%"></div>
                <div id="rev-bar-profit" class="bar-segment" style="background:#00a650; width:0%"></div>
            </div>
            <div style="display:flex; justify-content:space-between; font-size:0.75rem; color:#888; margin-top:5px;">
                <span>Custo</span><span>Taxas</span><span>Lucro</span>
            </div>
        </div>

        <div class="strategy-card" style="border: 2px solid var(--info);">
            <div style="position:absolute; top:20px; right:20px; background:var(--info); color:white; padding:2px 8px; border-radius:4px; font-size:0.7rem; font-weight:bold;">MANUAL</div>
            <h2>üßÆ Simular Lucro Real</h2>
            <div style="font-size:0.9rem; color:#666; margin-bottom:15px;">Teste pre√ßos finais (ex: 99,90) e veja o resultado.</div>

            <label>Pre√ßo de Venda Final (R$)</label>
            <input type="number" id="manualPrice" placeholder="Ex: 89,90" step="0.01" oninput="calcManual()">

            <div class="result-panel">
                <small>Seu Lucro ser√°:</small>
                <span class="big-price" id="man-profit" style="color:var(--success)">R$ 0,00</span>
                <div style="font-weight:bold; color:#555; margin-top:5px;">Margem: <span id="man-margin">0%</span></div>
                <div id="man-alert" class="alert-box"></div>
            </div>

            <div class="table-row"><span>Receita Bruta</span><span id="man-revenue">-</span></div>
            <div class="table-row"><span>(-) Custos Prod + Ops</span><span class="val-neg" id="man-cost">-</span></div>
            <div class="table-row"><span>(-) Comiss√µes + Imposto</span><span class="val-neg" id="man-fees">-</span></div>
            <div class="table-row"><span>(-) Frete / Taxa Fixa</span><span class="val-neg" id="man-ship">-</span></div>

            <div class="bar-chart">
                <div id="man-bar-cost" class="bar-segment" style="background:#ccc; width:0%"></div>
                <div id="man-bar-fee" class="bar-segment" style="background:#ffab00; width:0%"></div>
                <div id="man-bar-profit" class="bar-segment" style="background:#00a650; width:0%"></div>
            </div>
        </div>

    </div>
</div>

<script>
    // --- 1. CONFIGURATION DATA (2025 RULES) ---
    const BASE_SHIPPING = [
        { max: 0.3, cost: 39.90 }, { max: 0.5, cost: 42.90 }, { max: 1.0, cost: 44.90 },
        { max: 2.0, cost: 46.90 }, { max: 3.0, cost: 49.90 }, { max: 5.0, cost: 56.90 }, 
        { max: 9.0, cost: 88.90 }, { max: 13.0, cost: 131.90 }
    ];

    const DISCOUNTS = {
        'green':  [0.30, 0.35, 0.40, 0.45, 0.50],
        'yellow': [0.40, 0.45, 0.50, 0.55, 0.60],
        'orange': [1.00, 1.00, 1.00, 1.00, 1.00]
    };
    
    const RATES = { 'classic': 0.115, 'premium': 0.165 };

    // --- 2. APP STATE ---
    let state = {
        rep: 'green',
        cost: 0,
        opVal: 0,
        opType: 'fixed',
        weight: 0.3,
        tax: 0,
        rate: 0.115
    };

    // --- 3. EVENT HANDLERS ---
    function setRep(color) {
        state.rep = color;
        document.querySelectorAll('.rep-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-'+color).classList.add('active');
        recalcAll();
    }

    function updateOpHint() {
        const type = document.getElementById('opType').value;
        const hintEl = document.getElementById('opHint');
        const inputEl = document.getElementById('opExpenses');
        
        if (type === 'fixed') {
            hintEl.innerText = "Valor fixo em R$ somado ao custo do produto.";
            inputEl.placeholder = "Ex: 3,00";
        } else {
            hintEl.innerText = "Porcentagem % descontada do pre√ßo de venda final.";
            inputEl.placeholder = "Ex: 5.0";
        }
    }

    function recalcAll() {
        // Read Inputs (Handle empty as 0)
        state.cost = parseFloat(document.getElementById('productCost').value) || 0;
        state.opVal = parseFloat(document.getElementById('opExpenses').value) || 0;
        state.opType = document.getElementById('opType').value;
        state.weight = parseFloat(document.getElementById('weight').value);
        state.tax = (parseFloat(document.getElementById('taxRate').value) || 0) / 100;
        state.rate = RATES[document.getElementById('listingType').value];

        // Trigger Computations
        calcReverse();
        calcManual();
    }

    function syncPrice() {
        const pStr = document.getElementById('rev-price').innerText;
        const pVal = parseFloat(pStr.replace('R$','').replace(/\./g,'').replace(',','.').trim());
        if(pVal > 0) {
            const input = document.getElementById('manualPrice');
            input.value = pVal.toFixed(2);
            input.style.backgroundColor = '#fff3cd';
            setTimeout(() => input.style.backgroundColor = '#fff', 400);
            calcManual();
        }
    }

    // --- 4. BUSINESS LOGIC ---
    function getShippingAndFee(price) {
        let ship = 0;
        let fee = 0;
        if (price < 79.00) {
            if (price < 12.50) fee = price * 0.50; 
            else if (price < 29.00) fee = 6.25;
            else if (price < 50.00) fee = 6.50;
            else fee = 6.75;
        } else {
            const row = BASE_SHIPPING.find(r => r.max >= state.weight) || BASE_SHIPPING[BASE_SHIPPING.length-1];
            let idx = 0; // 79-99
            if (price >= 200) idx = 4;
            else if (price >= 150) idx = 3;
            else if (price >= 120) idx = 2;
            else if (price >= 100) idx = 1;
            ship = row.cost * DISCOUNTS[state.rep][idx];
        }
        return { ship, fee };
    }

    function getAlerts(price) {
        let alerts = [];
        if (price >= 74 && price < 79) alerts.push("‚ö†Ô∏è Cuidado: Pre√ßo pr√≥ximo de R$ 79. Se passar, voc√™ paga o frete!");
        if (price < 12.50) alerts.push("üõë Alerta: Abaixo de R$ 12,50 a taxa fixa vira 50% do valor.");
        return alerts;
    }

    // --- 5. CALCULATION ENGINES ---
    function calcReverse() {
        if(state.cost === 0) { resetResult('rev'); return; }
        
        const targetMarginInput = document.getElementById('targetMargin').value;
        if(!targetMarginInput) { resetResult('rev'); return; } // Wait for input
        
        const targetMargin = parseFloat(targetMarginInput) / 100;

        const tiers = [
            {min: 200, idx: 4}, {min: 150, idx: 3}, {min: 120, idx: 2}, 
            {min: 100, idx: 1}, {min: 79, idx: 0},
            {min: 50, fee: 6.75}, {min: 29, fee: 6.50}, {min: 12.50, fee: 6.25}, {min: 0, micro: true}
        ];
        
        const row = BASE_SHIPPING.find(r => r.max >= state.weight) || BASE_SHIPPING[BASE_SHIPPING.length-1];
        let bestP = 0;

        for (let t of tiers) {
            let S = 0, F = 0, V = 0;
            if (t.idx !== undefined) S = row.cost * DISCOUNTS[state.rep][t.idx];
            else if (t.fee) F = t.fee;
            else if (t.micro) V = 0.50;

            let OpFix = state.opType === 'fixed' ? state.opVal : 0;
            let OpPct = state.opType === 'pct' ? (state.opVal/100) : 0;

            const num = state.cost + OpFix + S + F;
            const den = 1.0 - (state.tax + state.rate + targetMargin + OpPct + V);
            
            if (den > 0) {
                const P = num / den;
                const prevTier = tiers[tiers.indexOf(t)-1];
                const max = prevTier ? prevTier.min : 999999;
                if (P >= t.min && P < max) { bestP = P; break; }
            }
        }

        // Display
        document.getElementById('rev-price').innerText = fmt(bestP);
        
        const details = getShippingAndFee(bestP);
        const op = state.opType === 'fixed' ? state.opVal : (bestP * state.opVal/100);
        const taxComm = bestP * (state.tax + state.rate);
        const profit = bestP - state.cost - op - details.ship - details.fee - taxComm;

        document.getElementById('rev-cost').innerText = "- " + fmt(state.cost + op);
        document.getElementById('rev-fees').innerText = "- " + fmt(taxComm);
        document.getElementById('rev-ship').innerText = "- " + fmt(details.ship + details.fee);
        document.getElementById('rev-profit').innerText = fmt(profit);

        updateBar('rev', bestP, state.cost + op, details.ship + details.fee + taxComm, profit);
        renderAlert('rev-alert', getAlerts(bestP));
    }

    function calcManual() {
        const priceInput = document.getElementById('manualPrice').value;
        const price = parseFloat(priceInput);
        
        if (!price || state.cost === 0) { resetResult('man'); return; }

        const details = getShippingAndFee(price);
        const op = state.opType === 'fixed' ? state.opVal : (price * state.opVal/100);
        const taxComm = price * (state.tax + state.rate);
        
        const profit = price - state.cost - op - details.ship - details.fee - taxComm;
        const margin = (profit / price) * 100;

        const pEl = document.getElementById('man-profit');
        pEl.innerText = fmt(profit);
        pEl.style.color = profit >= 0 ? "var(--success)" : "var(--danger)";
        
        document.getElementById('man-margin').innerText = margin.toFixed(2) + "%";
        document.getElementById('man-revenue').innerText = fmt(price);
        document.getElementById('man-cost').innerText = "- " + fmt(state.cost + op);
        document.getElementById('man-fees').innerText = "- " + fmt(taxComm);
        document.getElementById('man-ship').innerText = "- " + fmt(details.ship + details.fee);

        updateBar('man', price, state.cost + op, details.ship + details.fee + taxComm, profit);
        renderAlert('man-alert', getAlerts(price));
    }

    function resetResult(prefix) {
        if(prefix === 'rev') {
            document.getElementById('rev-price').innerText = "R$ 0,00";
            document.getElementById('rev-cost').innerText = "-";
            document.getElementById('rev-fees').innerText = "-";
            document.getElementById('rev-ship').innerText = "-";
            document.getElementById('rev-profit').innerText = "-";
            document.getElementById('rev-alert').style.display = 'none';
        } else {
            document.getElementById('man-profit').innerText = "R$ 0,00";
            document.getElementById('man-margin').innerText = "0%";
            document.getElementById('man-revenue').innerText = "-";
            document.getElementById('man-cost').innerText = "-";
            document.getElementById('man-fees').innerText = "-";
            document.getElementById('man-ship').innerText = "-";
            document.getElementById('man-alert').style.display = 'none';
        }
        updateBar(prefix, 0, 0, 0, 0);
    }

    function updateBar(prefix, total, cost, fees, profit) {
        if(total <= 0) {
            document.getElementById(prefix+'-bar-cost').style.width = "0%";
            document.getElementById(prefix+'-bar-fee').style.width = "0%";
            document.getElementById(prefix+'-bar-profit').style.width = "0%";
            return;
        }
        let c = (cost/total)*100;
        let f = (fees/total)*100;
        let p = (profit/total)*100;
        if(p < 0) p = 0;

        document.getElementById(prefix+'-bar-cost').style.width = c + "%";
        document.getElementById(prefix+'-bar-fee').style.width = f + "%";
        document.getElementById(prefix+'-bar-profit').style.width = p + "%";
    }

    function renderAlert(id, msgs) {
        const box = document.getElementById(id);
        if (msgs.length > 0) { box.style.display = 'block'; box.innerText = msgs[0]; }
        else { box.style.display = 'none'; }
    }

    function fmt(n) { return n.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'}); }

</script>

</body>
</html>
