<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Mercado Livre 2025 (Educativa)</title>
    <style>
        :root {
            --primary: #ffe600;
            --secondary: #2d3277;
            --text: #333;
            --light-gray: #f5f5f5;
            --border: #ddd;
            --success: #28a745;
            --danger: #dc3545;
            --info: #17a2b8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background: var(--light-gray);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container { max-width: 950px; margin: 0 auto; }
        
        /* Header */
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: var(--secondary); margin: 0; }
        .header p { color: #666; font-size: 0.9em; }

        /* Grid Layout */
        .grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 25px; }

        /* Cards */
        .card {
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        h2 { margin-top: 0; font-size: 1.4em; color: var(--secondary); border-bottom: 2px solid var(--primary); padding-bottom: 10px; display: inline-block;}
        h3 { font-size: 1.1em; margin: 20px 0 10px; color: #555; font-weight: 600; display: flex; align-items: center; }

        /* Inputs */
        .form-group { margin-bottom: 20px; position: relative; }
        .form-group label { display: block; font-weight: 600; font-size: 0.9rem; margin-bottom: 5px; color: var(--secondary); }
        
        .input-wrapper { display: flex; align-items: center; }
        .input-wrapper input, .input-wrapper select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        .input-wrapper input:focus { border-color: var(--secondary); outline: none; }
        
        /* Input Addons (R$ / %) */
        .input-group { display: flex; gap: 0; }
        .input-group input { border-top-right-radius: 0; border-bottom-right-radius: 0; flex: 2; }
        .input-group select { border-top-left-radius: 0; border-bottom-left-radius: 0; flex: 1; background: #f9f9f9; border-left: 0; min-width: 100px;}

        /* Hints & Education */
        .hint {
            display: block;
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
            background: #f8f9fa;
            padding: 6px 10px;
            border-left: 3px solid var(--info);
            border-radius: 0 4px 4px 0;
        }
        .hint strong { color: var(--secondary); }

        /* Action Buttons */
        .btn {
            background: var(--secondary);
            color: #fff;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 6px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
        }
        .btn:hover { background: #1a1e4d; transform: translateY(-1px); }
        .btn-small { padding: 4px 8px; font-size: 0.8em; margin-left: 10px; background: #e2e6ea; color: #333; border-radius: 4px; text-decoration: none; display: inline-block; cursor: pointer; }
        .btn-small:hover { background: #dbe0e5; }

        /* Results Area */
        .result-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        .final-price { font-size: 2.8em; font-weight: 800; color: var(--secondary); margin: 10px 0; }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            color: #fff;
            background: #6c757d;
        }
        .badge.micro { background: #17a2b8; }
        .badge.tier { background: #ffc107; color: #333; }
        .badge.free-shipping { background: #28a745; }

        /* Breakdown Table */
        .table-container { margin-top: 20px; border: 1px solid #eee; border-radius: 6px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        td { padding: 10px 15px; border-bottom: 1px solid #f0f0f0; }
        tr:last-child td { border-bottom: none; }
        .text-right { text-align: right; }
        .text-danger { color: var(--danger); }
        .text-success { color: var(--success); font-weight: bold; }
        .row-highlight { background-color: #fcfcfc; font-weight: 500; }

        /* Modal for Shipping Table */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center;
        }
        .modal-content {
            background: #fff; padding: 25px; border-radius: 8px; max-width: 500px; width: 90%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2); position: relative;
        }
        .close-btn { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; color: #999; }
        
        .shipping-table { width: 100%; margin-top: 10px; border: 1px solid #ddd; }
        .shipping-table th { background: var(--secondary); color: #fff; padding: 8px; text-align: left; }
        .shipping-table td { border-bottom: 1px solid #eee; padding: 8px; }

        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Simulador de Lucro Real - Mercado Livre 2025</h1>
        <p>Entenda cada centavo das taxas antes de anunciar.</p>
    </div>

    <div class="grid">
        <div class="card">
            <h2>1. Estrutura de Custos</h2>
            
            <div class="form-group">
                <label>Custo do Produto (CMV) *</label>
                <div class="input-wrapper">
                    <input type="number" id="productCost" placeholder="R$ 0,00" step="0.01">
                </div>
                <small class="hint">Quanto voc√™ paga para fabricar ou comprar o item.</small>
            </div>

            <div class="form-group">
                <label>
                    Custo de Envio (Tabela ML)
                    <span class="btn-small" onclick="openModal()">Ver Tabela 2025</span>
                </label>
                <div class="input-wrapper">
                    <input type="number" id="shippingCost" placeholder="R$ 0,00" step="0.01">
                </div>
                <small class="hint">
                    <strong>Aten√ß√£o:</strong> Obrigat√≥rio apenas se o pre√ßo de venda final for <strong>maior que R$ 79,00</strong>. 
                    Caso contr√°rio, deixe R$ 0,00 (quem paga √© o comprador).
                </small>
            </div>

            <div class="form-group">
                <label>Despesas Operacionais / Embalagem</label>
                <div class="input-group">
                    <input type="number" id="opExpenses" placeholder="3,00" step="0.01">
                    <select id="opExpensesType" onchange="updateOpsHint()">
                        <option value="fixed">R$ (Fixo)</option>
                        <option value="pct">% (Venda)</option>
                    </select>
                </div>
                <small class="hint" id="opsHint">Custo de fita, caixa, etiqueta t√©rmica, etc.</small>
            </div>

            <h2>2. Configura√ß√µes de Venda</h2>

            <div class="form-group">
                <label>Margem de Lucro L√≠quida Desejada (%)</label>
                <div class="input-wrapper">
                    <input type="number" id="targetMargin" placeholder="Ex: 15" step="0.1">
                </div>
                <small class="hint">Quanto voc√™ quer colocar no bolso (limpo) ap√≥s pagar tudo.</small>
            </div>

            <div class="form-group">
                <label>Tipo de An√∫ncio (Exposi√ß√£o)</label>
                <div class="input-wrapper">
                    <select id="listingType">
                        <option value="classic">Cl√°ssico (Aprox. 11.5%) - Sem Parcelamento</option>
                        <option value="premium">Premium (Aprox. 16.5%) - Parcelado S/ Juros</option>
                    </select>
                </div>
                <small class="hint">O Premium vende mais, mas a taxa √© maior. Use Premium para itens acima de R$ 100.</small>
            </div>

            <div class="form-group">
                <label>Impostos (Simples Nacional / NFe) (%)</label>
                <div class="input-wrapper">
                    <input type="number" id="taxRate" placeholder="Ex: 4.0" step="0.1">
                </div>
                <small class="hint">A al√≠quota da sua nota fiscal. Se for MEI, coloque 0%.</small>
            </div>

            <button class="btn" onclick="calculatePrice()">Calcular Pre√ßo Ideal</button>
        </div>

        <div class="card">
            <h2>3. An√°lise Financeira</h2>
            
            <div id="emptyState" style="text-align:center; color:#999; padding: 40px;">
                <p>Preencha os dados ao lado para gerar sua DRE (Demonstrativo de Resultado).</p>
            </div>

            <div id="resultContainer" style="display:none;">
                <div class="result-box">
                    <span>Pre√ßo de Venda Sugerido</span>
                    <div class="final-price" id="displayPrice">R$ 0,00</div>
                    <div id="tierBadge"></div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr style="background:#eee;">
                                <th style="text-align:left; padding:10px;">Descri√ß√£o</th>
                                <th style="text-align:right; padding:10px;">Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="row-highlight">
                                <td>(+) Venda Bruta</td>
                                <td class="text-right" id="dtPrice">R$ 0,00</td>
                            </tr>
                            <tr>
                                <td>(-) Impostos</td>
                                <td class="text-right text-danger" id="dtTax">- R$ 0,00</td>
                            </tr>
                            <tr>
                                <td>(-) Comiss√£o ML</td>
                                <td class="text-right text-danger" id="dtComm">- R$ 0,00</td>
                            </tr>
                            <tr>
                                <td>
                                    (-) Taxa Fixa ML 
                                    <span style="font-size:0.8em; color:#777; display:block;">Custo por vender abaixo de R$ 79</span>
                                </td>
                                <td class="text-right text-danger" id="dtFixedFee">- R$ 0,00</td>
                            </tr>
                            <tr>
                                <td>
                                    (-) Frete Gr√°tis (Seller)
                                    <span style="font-size:0.8em; color:#777; display:block;">Obrigat√≥rio acima de R$ 79</span>
                                </td>
                                <td class="text-right text-danger" id="dtShipping">- R$ 0,00</td>
                            </tr>
                            <tr style="border-bottom: 2px solid #ddd;">
                                <td>(-) Custos Totais (Produto + Ops)</td>
                                <td class="text-right text-danger" id="dtTotalCost">- R$ 0,00</td>
                            </tr>
                            <tr class="row-highlight">
                                <td style="font-size:1.1em; color:var(--success);"><strong>(=) Lucro L√≠quido</strong></td>
                                <td class="text-right text-success" style="font-size:1.1em;" id="dtProfit">R$ 0,00</td>
                            </tr>
                            <tr>
                                <td>Margem Real</td>
                                <td class="text-right" id="dtMargin">0%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top:20px; font-size:0.9em; background:#e8f4fd; padding:10px; border-radius:4px; color:#0c5460;">
                    <strong>Dica do Consultor:</strong> 
                    <span id="consultantTip">O pre√ßo est√° equilibrado.</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="shippingModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h3 style="margin-top:0;">Estimativa de Frete 2025 (MercadoL√≠der)</h3>
        <p style="font-size:0.9em;">Valores aproximados para envio nacional. Use como refer√™ncia para o campo "Custo de Envio".</p>
        
        <table class="shipping-table">
            <thead>
                <tr>
                    <th>Peso do Produto</th>
                    <th style="text-align:right">Custo Estimado</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>At√© 300g</td>
                    <td style="text-align:right">R$ 16,50 - R$ 18,50</td>
                </tr>
                <tr>
                    <td>300g a 500g</td>
                    <td style="text-align:right">R$ 18,00 - R$ 20,00</td>
                </tr>
                <tr>
                    <td>500g a 1kg</td>
                    <td style="text-align:right">R$ 19,50 - R$ 21,50</td>
                </tr>
                <tr>
                    <td>1kg a 2kg</td>
                    <td style="text-align:right">R$ 20,50 - R$ 22,50</td>
                </tr>
                <tr>
                    <td>2kg a 5kg</td>
                    <td style="text-align:right">R$ 25,00 - R$ 30,00</td>
                </tr>
                <tr>
                    <td>5kg a 9kg</td>
                    <td style="text-align:right">R$ 45,00 - R$ 55,00</td>
                </tr>
            </tbody>
        </table>
        <p style="font-size:0.8em; color:#666; margin-top:10px;">*Vendedores sem reputa√ß√£o (Amarela/Laranja) pagam aprox. 40% a mais.</p>
    </div>
</div>

<script>
    // --- Configuration: Rules 2025 ---
    const FEE_RULES = {
        free_shipping_threshold: 79.00,
        tiers: [
            { max: 12.50, fee: 0.0, type: 'pct', val: 0.50, name: "Micro Pre√ßo (< R$ 12,50)", desc: "Taxa de 50% do valor" },
            { max: 29.00, fee: 6.25, type: 'fixed', val: 6.25, name: "Tier Baixo", desc: "Taxa Fixa R$ 6,25" },
            { max: 50.00, fee: 6.50, type: 'fixed', val: 6.50, name: "Tier M√©dio", desc: "Taxa Fixa R$ 6,50" },
            { max: 79.00, fee: 6.75, type: 'fixed', val: 6.75, name: "Tier Alto", desc: "Taxa Fixa R$ 6,75" },
            { max: 999999, fee: 0.0, type: 'fixed', val: 0.00, name: "Frete Gr√°tis (> R$ 79)", desc: "Taxa Fixa Isenta", shippingRequired: true }
        ]
    };

    const LISTING_RATES = { 'classic': 0.115, 'premium': 0.165 };

    // --- Modal Logic ---
    function openModal() { document.getElementById('shippingModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('shippingModal').style.display = 'none'; }
    window.onclick = function(event) {
        if (event.target == document.getElementById('shippingModal')) closeModal();
    }

    function updateOpsHint() {
        const type = document.getElementById('opExpensesType').value;
        const hint = document.getElementById('opsHint');
        hint.innerHTML = type === 'fixed' 
            ? "Valor fixo em <strong>Reais (R$)</strong> somado aos custos." 
            : "Percentual <strong>(%)</strong> descontado sobre o Pre√ßo FINAL.";
    }

    // --- Calculation Logic ---
    function calculatePrice() {
        // 1. Get Inputs
        const cost = parseFloat(document.getElementById('productCost').value);
        if (isNaN(cost)) { alert("Insira o Custo do Produto para come√ßar."); return; }

        const shippingIfFree = parseFloat(document.getElementById('shippingCost').value) || 0;
        const marginPct = (parseFloat(document.getElementById('targetMargin').value) || 0) / 100;
        const taxPct = (parseFloat(document.getElementById('taxRate').value) || 0) / 100;
        const commissionPct = LISTING_RATES[document.getElementById('listingType').value];
        
        // Op Expenses Handling
        const opVal = parseFloat(document.getElementById('opExpenses').value) || 0;
        const opType = document.getElementById('opExpensesType').value;
        const opFixed = opType === 'fixed' ? opVal : 0;
        const opPct = opType === 'pct' ? opVal / 100 : 0;

        const inputs = { cost, shippingIfFree, opFixed, opPct, marginPct, taxPct, commissionPct };

        // 2. Determine Price Tier (Reverse Order)
        let bestPrice = null;
        let selectedTier = null;

        // Try Frete Gratis Tier
        const pFree = solveFormula(inputs, 0, inputs.shippingIfFree);
        if (pFree >= FEE_RULES.free_shipping_threshold) {
            bestPrice = pFree; selectedTier = FEE_RULES.tiers[4];
        }

        // Try Fixed Fee Tiers
        if (!bestPrice) {
            // High (50-79) -> Fee 6.75
            let p = solveFormula(inputs, 6.75, 0);
            if (p >= 50 && p < 79) { bestPrice = p; selectedTier = FEE_RULES.tiers[3]; }
            
            // Mid (29-50) -> Fee 6.50
            else {
                p = solveFormula(inputs, 6.50, 0);
                if (p >= 29 && p < 50) { bestPrice = p; selectedTier = FEE_RULES.tiers[2]; }
                
                // Low (12.50-29) -> Fee 6.25
                else {
                    p = solveFormula(inputs, 6.25, 0);
                    if (p >= 12.50 && p < 29) { bestPrice = p; selectedTier = FEE_RULES.tiers[1]; }
                    
                    // Micro (<12.50) -> Fee 50%
                    else {
                        // Formula adjustment for 50% fee: Add 0.50 to variable rates
                        inputs.extraVarRate = 0.50; 
                        p = solveFormula(inputs, 0, 0); 
                        inputs.extraVarRate = 0; // reset
                        
                        if (p < 12.50) { bestPrice = p; selectedTier = FEE_RULES.tiers[0]; }
                    }
                }
            }
        }

        render(bestPrice, selectedTier, inputs);
    }

    function solveFormula(inputs, fixedFee, shipping) {
        // P = (FixedCosts) / (1 - VariableRates)
        const numerator = inputs.cost + inputs.opFixed + shipping + fixedFee;
        const denominator = 1.0 - (inputs.taxPct + inputs.commissionPct + inputs.marginPct + inputs.opPct + (inputs.extraVarRate || 0));
        
        if (denominator <= 0) return Infinity;
        return numerator / denominator;
    }

    // --- Rendering ---
    function render(price, tier, inputs) {
        if (!price || price === Infinity) {
            alert("Imposs√≠vel calcular. A soma das taxas e margem ultrapassa 100%.");
            return;
        }

        document.getElementById('emptyState').style.display = 'none';
        document.getElementById('resultContainer').style.display = 'block';

        // Calculate Values
        let feeVal = tier.type === 'pct' ? price * 0.50 : tier.val;
        let shipVal = tier.shippingRequired ? inputs.shippingIfFree : 0;
        let opVal = inputs.opFixed > 0 ? inputs.opFixed : (price * inputs.opPct);
        let taxVal = price * inputs.taxPct;
        let commVal = price * inputs.commissionPct;
        let profit = price - inputs.cost - opVal - shipVal - feeVal - taxVal - commVal;

        // UI Updates
        document.getElementById('displayPrice').innerText = fmt(price);
        
        let badgeClass = tier.shippingRequired ? 'badge free-shipping' : (tier.name.includes("Micro") ? 'badge micro' : 'badge tier');
        document.getElementById('tierBadge').innerHTML = `<span class="${badgeClass}">${tier.name}</span> <span style="font-size:0.8em; color:#666; margin-left:5px;">(${tier.desc})</span>`;

        document.getElementById('dtPrice').innerText = fmt(price);
        document.getElementById('dtTax').innerText = "- " + fmt(taxVal);
        document.getElementById('dtComm').innerText = "- " + fmt(commVal);
        document.getElementById('dtFixedFee').innerText = "- " + fmt(feeVal);
        document.getElementById('dtShipping').innerText = "- " + fmt(shipVal);
        document.getElementById('dtTotalCost').innerText = "- " + fmt(inputs.cost + opVal);
        document.getElementById('dtProfit').innerText = fmt(profit);
        document.getElementById('dtMargin').innerText = ((profit/price)*100).toFixed(1) + "%";

        // Consultant Tip
        const tipEl = document.getElementById('consultantTip');
        if (tier.shippingRequired && inputs.shippingIfFree === 0) {
            tipEl.innerHTML = "‚ö†Ô∏è <strong>Aten√ß√£o:</strong> O pre√ßo superou R$ 79,00, mas voc√™ n√£o informou o custo do frete. Seu lucro real ser√° menor que o mostrado.";
            tipEl.parentElement.style.background = "#fff3cd";
            tipEl.parentElement.style.color = "#856404";
        } else if (tier.name.includes("Micro")) {
            tipEl.innerHTML = "üí° <strong>Dica:</strong> Para produtos abaixo de R$ 12,50, o ML cobra 50% de taxa. Considere vender kits (3 unidades) para fugir dessa faixa.";
            tipEl.parentElement.style.background = "#d4edda";
            tipEl.parentElement.style.color = "#155724";
        } else {
            tipEl.innerHTML = "‚úÖ C√°lculo realizado com sucesso considerando todas as faixas do Mercado Livre 2025.";
            tipEl.parentElement.style.background = "#e8f4fd";
            tipEl.parentElement.style.color = "#0c5460";
        }
    }

    function fmt(n) { return n.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'}); }
    
    // Init
    updateOpsHint();
</script>

</body>
</html>
